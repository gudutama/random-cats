name: Update Cats Database

# –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç?
on:
  schedule:
    - cron: '50 23 * * *' # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 –Ω–æ—á–∏
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é –ø–æ –∫–Ω–æ–ø–∫–µ!

env:
  TZ: 'Europe/Warsaw' # –ò–ª–∏ —Ç–≤–æ–π –≥–æ—Ä–æ–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä 'Europe/Kyiv'

jobs:
  run-scraper:
    runs-on: ubuntu-latest # –†–æ–±–æ—Ç –≤–∫–ª—é—á–∏—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Linux

    steps:
    # 1. –†–æ–±–æ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ç–≤–æ–∏ —Ñ–∞–π–ª—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã
      uses: actions/checkout@v4

    # 2. –†–æ–±–æ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ä–µ–¥—É C# (.NET)
    - name: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x' # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é (–ø–æ–¥–æ–π–¥–µ—Ç –∏ –¥–ª—è 6.0/7.0)

    # 3. –†–æ–±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–≤–æ—é –ø—Ä–æ–≥—Ä–∞–º–º—É!
    - name: –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä
      run: dotnet run

    # 4. –†–æ–±–æ—Ç –±–µ—Ä–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π cats.json –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –Ω–∞ —Å–∞–π—Ç
    - name: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add cats.json
        git commit -m "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –∫–æ—Ç–æ–≤ ü§ñüê±" || echo "–ù–æ–≤—ã—Ö –∫–æ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç"
        git push

    - name: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Discord
      run: |
        DAILY_CAT=$(node -e "
          const fs = require('fs');
          const cats = JSON.parse(fs.readFileSync('cats.json'));
          const now = new Date();
          const daySeed = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
          const x = Math.sin(daySeed) * 10000;
          const randomFraction = x - Math.floor(x);
          const index = Math.floor(randomFraction * cats.length);
          console.log(cats[index]);
        ")
        
        # –í–æ—Ç —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞:
        curl -H "Content-Type: application/json" \
             -d "{\"content\": \"@everyone\", \"embeds\": [{\"title\": \"–ö–æ—Ç –¥–Ω—è:\", \"image\": {\"url\": \"$DAILY_CAT\"}}]}" \
             ${{ secrets.DISCORD_WEBHOOK }}
